openapi: 3.0.3
info:
  title: Recipe Maps API
  version: 1.0.0
  description: Egyszerű API régiók és települések listázására.
servers:
  - url: http://localhost:3000
    description: Local dev server
paths:
  /api/maps/regions:
    get:
      parameters:
        - in: query
          name: regionId
          description: Opcionális szűrés. Több regionId megadható (?regionId=1&regionId=2) vagy vesszővel elválasztva (?regionId=1,2).
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int32
          style: form
          explode: true
      tags: [Maps]
      summary: Régiók listázása (GeoJSON geometriával)
      description: Visszaadja az összes régiót név szerinti rendezéssel. A `geom` mező GeoJSON Geometry objektum.
      responses:
        '200':
          description: Sikeres lekérdezés
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RegionWithGeom'
              examples:
                sample:
                  value:
                    - id: 1
                      name: "Budapest"
                      geom:
                        type: Polygon
                        coordinates: [[[19.0,47.4],[19.3,47.4],[19.3,47.6],[19.0,47.6],[19.0,47.4]]]
                    - id: 2
                      name: "Bács-Kiskun"
                      geom: null
  /api/maps/settlements:
    get:
      parameters:
        - in: query
          name: regionId
          description: Opcionális szűrés. Több regionId megadható (?regionId=1&regionId=2) vagy vesszővel elválasztva (?regionId=1,2).
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int32
          style: form
          explode: true
        - in: query
          name: settlementid
          description: Opcionális szűrés. Több település ID is megadható (?settlementid=101&settlementid=102) vagy vesszővel elválasztva (?settlementid=101,102).
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          style: form
          explode: true
      tags: [Maps]
      summary: Települések listázása (GeoJSON geometriával)
      description: Visszaadja az összes települést név szerinti rendezéssel. A `geom` mező GeoJSON Geometry objektum.
      responses:
        '200':
          description: Sikeres lekérdezés
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SettlementWithGeom'
              examples:
                sample:
                  value:
                    - id: 101
                      name: "Budapest I. kerület"
                      regionid: 1
                      geom: null
                    - id: 102
                      name: "Kecskemét"
                      regionid: 2
                      geom:
                        type: Polygon
                        coordinates: [[[19.6,46.9],[19.8,46.9],[19.8,47.0],[19.6,47.0],[19.6,46.9]]]
  /api/recipes:
    get:
      tags: [Recipes]
      summary: Receptek listázása
      description: Visszaadja az összes receptet, opcionális szűrőkkel (év, település, kategória, régió). A válasz tartalmazza az összes találat számát is.
      parameters:
        - in: query
          name: regionId
          required: false
          description: Opcionális szűrés régió(k) szerint. Több regionId megadható (?regionId=1&regionId=2) vagy vesszővel elválasztva (?regionId=1,2). A régió szűrő település ID-kká kerül kibontásra.
          schema:
            type: array
            items:
              type: integer
              format: int32
          style: form
          explode: true
        - in: query
          name: year
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int32
          style: form
          explode: true
        - in: query
          name: settlementId
          required: false
          description: Opcionális szűrés település(ek) szerint.
          schema:
            type: array
            items:
              type: integer
              format: int64
          style: form
          explode: true
        - in: query
          name: categoryId
          required: false
          description: Opcionális szűrés kategória(k) szerint.
          schema:
            type: array
            items:
              type: integer
              format: int32
          style: form
          explode: true
      responses:
        "200":
          description: Sikeres lekérdezés
          headers:
            X-Total-Count:
              description: Találatok teljes száma a szűrők figyelembevételével
              schema:
                type: integer
                format: int64
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeListResponse"
              examples:
                sample:
                  value:
                    count: 2
                    items:
                      - url: "https://www.izorzok.hu/foispan-fule/"
                        title: "Főispán füle"
                        year: 2025
                        settlement_id: 123
                        category_id: 13
                      - url: "https://www.izorzok.hu/valami/"
                        title: "Valami recept"
                        year: null
                        settlement_id: null
                        category_id: 7

  /api/recipes/categories:
    get:
      tags: [Recipes]
      summary: Kategóriák listázása
      description: Visszaadja az összes recept kategóriát név szerinti rendezéssel.
      responses:
        '200':
          description: Sikeres lekérdezés
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
              examples:
                sample:
                  value:
                    - id: 1
                      name: Levesek
                    - id: 2
                      name: Főételek
components:
  schemas:
    Region:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Régió azonosítója
        name:
          type: string
          nullable: true
          description: Régió neve
      required: [id]
    Geometry:
      type: object
      required: [type, coordinates]
      properties:
        type:
          type: string
          enum: [Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon]
        coordinates:
          description: GeoJSON koordináták
          oneOf:
            - type: array
              items:
                type: number
            - type: array
              items:
                type: array
                items:
                  type: number
            - type: array
              items:
                type: array
                items:
                  type: array
                  items:
                    type: number
    RegionWithGeom:
      allOf:
        - $ref: '#/components/schemas/Region'
        - type: object
          properties:
            geom:
              nullable: true
              $ref: '#/components/schemas/Geometry'
    Settlement:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Település azonosítója
        name:
          type: string
          nullable: true
          description: Település neve
        regionid:
          type: integer
          format: int32
          nullable: true
          description: Régió azonosító
      required: [id]
    SettlementWithGeom:
      allOf:
        - $ref: '#/components/schemas/Settlement'
        - type: object
          properties:
            geom:
              nullable: true
              $ref: '#/components/schemas/Geometry'

    RecipeListItem:
      type: object
      properties:
        url:
          type: string
        title:
          type: string
        year:
          type: integer
          format: int32
          nullable: true
        settlement_id:
          type: integer
          format: int64
          nullable: true
        category_id:
          type: integer
          format: int32
          nullable: true

    RecipeListResponse:
      type: object
      properties:
        count:
          type: integer
          format: int64
        items:
          type: array
          items:
            $ref: '#/components/schemas/RecipeListItem'
      required: [count, items]

    Category:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Kategória azonosítója
        name:
          type: string
          nullable: true
          description: Kategória neve
      required: [id]
